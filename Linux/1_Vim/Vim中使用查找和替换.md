# Vim 中使用查找和替换

[出处：在 Vim 中优雅地查找和替换](http://harttle.com/2016/08/08/vim-search-in-file.html)

[附：转义字符说明](#转义字符)

### 查找

在normal模式下按下`/`即可进入查找模式，输入要查找的字符串并按下回车。 Vim会跳转到第一个匹配。按下`n`查找下一个，按下`N`查找上一个。

Vim查找支持正则表达式，例如`/vim$`匹配行尾的"vim"。 需要查找特殊字符需要转义，例如`/vim\$`匹配"vim$"。

>注意查找回车应当用\n，而替换为回车应当用\r（相当于<CR>）。


##### 大小写敏感查找
在查找模式中加入\c表示大小写不敏感查找，\C表示大小写敏感查找。例如：

`/foo\c`

将会查找所有的`"foo"`,`"FOO"`,`"Foo"`等字符串。

#### 大小写敏感配置
Vim 默认采用大小写敏感的查找，为了方便我们常常将其配置为大小写不敏感：

```
" 设置默认进行大小写不敏感查找
set ignorecase
" 如果有一个大写字母，则切换到大小写敏感查找
set smartcase 
```
>将上述设置粘贴到你的~/.vimrc，重新打开Vim即可生效。

#### 查找当前单词
在normal模式下按下`*`即可查找光标所在单词（word）， 要求每次出现的前后为空白字符或标点符号。例如当前为`foo`， 可以匹配`foo bar`中的foo，但不可匹配`foobar`中的`foo`。 这在查找函数名、变量名时非常有用。

按下`g*`即可查找光标所在单词的字符序列，每次出现前后字符无要求。 即`foo bar`和`foobar`中的`foo`均可被匹配到。

### 查找与替换

:s（substitute）命令用来查找和替换字符串。语法如下：

	:{作用范围}s/{目标}/{替换}/{替换标志}
	
例如`:%s/foo/bar/g`会在全局范围`(%)`查找`foo`并替换为`bar`，所有出现都会被替换（`g`）。

#### 作用范围

作用范围分为当前行、全文、选区等等。

当前行：

	:s/foo/bar/g
全文：

	:%s/foo/bar/g
选区，在Visual模式下选择区域后输入:，Vim即可自动补全为` :'<,'>`。

	:'<,'>s/foo/bar/g
2-11行：

	:5,12s/foo/bar/g
当前行.与接下来两行`+2`：

	:.,+2s/foo/bar/g
	
#### 替换标志

上文中命令结尾的`g`即是替换标志之一，表示全局`global`替换（即替换目标的所有出现）。 还有很多其他有用的替换标志：

空替换标志表示只替换从光标位置开始，目标的第一次出现：

	:%s/foo/bar
`i`表示大小写不敏感查找，`I`表示大小写敏感：

```
:%s/foo/bar/i
# 等效于模式中的\c（不敏感）或\C（敏感）
:%s/foo\c/bar
```
`c`表示需要确认，例如全局查找`"foo"`替换为`"bar"`并且需要确认：

	:%s/foo/bar/gc
回车后Vim会将光标移动到每一次`"foo"`出现的位置，并提示

	replace with bar (y/n/a/q/l/^E/^Y)?
按下`y`表示替换，`n`表示不替换，`a`表示替换所有，`q`表示退出查找模式， `l`表示替换当前位置并退出。`^E`与`^Y`是光标移动快捷键。


#### 转义字符

>转义字符是这样一个字符，标志着在一个字符序列中出现在它之后的后续几个字符采取一种替代解释.

>最常见的一个例子是C程序设计语言中，用反斜线字符“\”作为转义字符，来表示那些不可打印的ASCII控制符。在URI协议中，转义字符是百分号“%”.

>许多程序设计语言把双引号字符（"）用作字符串的分界符。反斜线（\）转义字符提供了两种方式来把双引号字符置入字符串中，或者是使用转义序列\"表示单个的"字符本身，而不是作为字符串分界符；或者是直接开始字符"的16进制编码值的转义序列\x22来表示".也可以使用8进制编码值的转义序列，如\042.

>在Perl或者Python程序设计语言中

><pre>print "Nancy said "Hello World!" to the crowd.";</pre>

>将产生语法错误。而

><pre>print "Nancy said \"Hello World!\" to the crowd.";  ### example of \"</pre>

>将产生期望的输出结果。 另一种可选择的办法是：

><pre>print "Nancy said \x22Hello World!\x22 to them.";  ### example of \x22</pre>

>使用双引号字符编码值的十六进制"x22"转义字符序列. 但是，如果运行在非ASCII计算机上，将不会产生预期的结果。


>**vim中的转义,如：** 

>将每一行的 “apple/” 字符替换成 “apple/wukuan/”

><pre>%s/apple\//apple\/wukuang\//g</pre>
